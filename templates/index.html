{% extends "base.html" %}

{% block title %}Ana Sayfa - Flask App{% endblock %}

{% block content %}
<div class="container">
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Jenkins CI/CD ile Otomatik Deployment</h1>
            <p class="hero-subtitle">Her push ile otomatik gÃ¼ncellenen modern Flask uygulamasÄ±</p>
            <div class="stats-card">
                <div class="stat-item">
                    <span class="stat-number">{{ visit_count }}</span>
                    <span class="stat-label">Toplam Ziyaret</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="visitor-count">0</span>
                    <span class="stat-label">KayÄ±tlÄ± ZiyaretÃ§i</span>
                </div>
            </div>
        </div>
    </div>

    <div class="features-section">
        <h2 class="section-title">Ã–zellikler</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">ðŸ”„</div>
                <h3>Otomatik CI/CD</h3>
                <p>Jenkins pipeline ile her push'ta otomatik build ve deploy</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ðŸŽ¨</div>
                <h3>Modern TasarÄ±m</h3>
                <p>Mavi tonlarÄ±nda profesyonel ve responsive arayÃ¼z</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">âš¡</div>
                <h3>HÄ±zlÄ± ve Hafif</h3>
                <p>Flask framework ile optimize edilmiÅŸ performans</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ðŸ“Š</div>
                <h3>GerÃ§ek ZamanlÄ±</h3>
                <p>API ile dinamik veri yÃ¶netimi ve istatistikler</p>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h2 class="section-title">ZiyaretÃ§i Defteri</h2>
        <div class="form-card">
            <form id="visitor-form">
                <div class="form-group">
                    <label for="name">Ä°sminiz</label>
                    <input type="text" id="name" name="name" required placeholder="AdÄ±nÄ±zÄ± girin">
                </div>
                <div class="form-group">
                    <label for="message">MesajÄ±nÄ±z</label>
                    <textarea id="message" name="message" rows="4" required placeholder="Bir mesaj bÄ±rakÄ±n..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">GÃ¶nder</button>
            </form>
            <div id="message-status" class="message-status"></div>
        </div>

        <div class="visitors-list" id="visitors-list">
            <h3>Son ZiyaretÃ§iler</h3>
            <div id="visitors-content"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    loadVisitors();

    document.getElementById('visitor-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const name = document.getElementById('name').value;
        const message = document.getElementById('message').value;

        try {
            const response = await fetch('/api/visitors', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name, message })
            });

            const data = await response.json();

            if (data.success) {
                showMessage('MesajÄ±nÄ±z kaydedildi!', 'success');
                document.getElementById('visitor-form').reset();
                loadVisitors();
            }
        } catch (error) {
            showMessage('Bir hata oluÅŸtu!', 'error');
        }
    });

    function showMessage(text, type) {
        const statusDiv = document.getElementById('message-status');
        statusDiv.textContent = text;
        statusDiv.className = `message-status ${type}`;
        setTimeout(() => {
            statusDiv.className = 'message-status';
        }, 3000);
    }

    async function loadVisitors() {
        try {
            const response = await fetch('/api/visitors');
            const data = await response.json();

            document.getElementById('visitor-count').textContent = data.count;

            const visitorsContent = document.getElementById('visitors-content');
            if (data.visitors.length === 0) {
                visitorsContent.innerHTML = '<p class="no-visitors">HenÃ¼z ziyaretÃ§i yok. Ä°lk ziyaretÃ§i siz olun!</p>';
            } else {
                visitorsContent.innerHTML = data.visitors.slice(-5).reverse().map(visitor => `
                    <div class="visitor-item">
                        <div class="visitor-header">
                            <strong>${visitor.name}</strong>
                            <span class="visitor-time">${visitor.timestamp}</span>
                        </div>
                        <p class="visitor-message">${visitor.message}</p>
                    </div>
                `).join('');
            }
        } catch (error) {
            console.error('Error loading visitors:', error);
        }
    }

    setInterval(loadVisitors, 30000);
</script>
{% endblock %}
